=== Running hd = 32 lr = 0.001 wd = 0.0
Ep    1 | train_acc=0.0106, test_acc=0.0123 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.290 | rem_dirs=32 | node_sim=0.005 | stage=1
Ep  100 | train_acc=0.1031, test_acc=0.0040 | ΔW_norm=1.239e-01 | avgΔW=1.235e-01 | grad_cos=0.014 | avg_grad_cos=-0.003 | feat_div=3.303 | rem_dirs=32 | node_sim=0.012 | stage=1
Ep  200 | train_acc=0.2043, test_acc=0.0100 | ΔW_norm=1.313e-01 | avgΔW=1.251e-01 | grad_cos=-0.020 | avg_grad_cos=-0.007 | feat_div=3.275 | rem_dirs=31 | node_sim=0.022 | stage=1
Ep  300 | train_acc=0.4611, test_acc=0.0572 | ΔW_norm=1.322e-01 | avgΔW=1.316e-01 | grad_cos=0.001 | avg_grad_cos=-0.001 | feat_div=3.040 | rem_dirs=31 | node_sim=0.010 | stage=1
Ep  400 | train_acc=0.6543, test_acc=0.1107 | ΔW_norm=1.154e-01 | avgΔW=1.180e-01 | grad_cos=0.025 | avg_grad_cos=0.004 | feat_div=2.842 | rem_dirs=32 | node_sim=0.010 | stage=1
Ep  500 | train_acc=0.8025, test_acc=0.1732 | ΔW_norm=1.163e-01 | avgΔW=1.139e-01 | grad_cos=-0.002 | avg_grad_cos=-0.004 | feat_div=2.728 | rem_dirs=32 | node_sim=0.011 | stage=1
Ep  600 | train_acc=0.9007, test_acc=0.2395 | ΔW_norm=1.114e-01 | avgΔW=1.111e-01 | grad_cos=0.002 | avg_grad_cos=-0.018 | feat_div=2.745 | rem_dirs=32 | node_sim=0.009 | stage=1
Ep  700 | train_acc=0.9866, test_acc=0.3705 | ΔW_norm=9.778e-02 | avgΔW=1.025e-01 | grad_cos=0.007 | avg_grad_cos=-0.005 | feat_div=2.719 | rem_dirs=32 | node_sim=0.005 | stage=1
Ep  800 | train_acc=1.0000, test_acc=0.4725 | ΔW_norm=7.224e-02 | avgΔW=7.291e-02 | grad_cos=0.019 | avg_grad_cos=-0.001 | feat_div=2.810 | rem_dirs=32 | node_sim=0.001 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.5452 | ΔW_norm=5.441e-02 | avgΔW=5.605e-02 | grad_cos=-0.001 | avg_grad_cos=0.010 | feat_div=2.749 | rem_dirs=32 | node_sim=-0.001 | stage=1
Ep 1000 | train_acc=1.0000, test_acc=0.5957 | ΔW_norm=4.322e-02 | avgΔW=4.409e-02 | grad_cos=-0.023 | avg_grad_cos=0.007 | feat_div=2.801 | rem_dirs=32 | node_sim=-0.003 | stage=1
Total elapsed: 236.5276563167572
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.001_wd0.0_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.001_wd0.0_fig.png
=== Running hd = 32 lr = 0.001 wd = 0.0001
Ep    1 | train_acc=0.0106, test_acc=0.0121 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.289 | rem_dirs=32 | node_sim=0.005 | stage=1
Ep  100 | train_acc=0.0989, test_acc=0.0032 | ΔW_norm=1.285e-01 | avgΔW=1.299e-01 | grad_cos=0.012 | avg_grad_cos=-0.005 | feat_div=3.305 | rem_dirs=32 | node_sim=0.007 | stage=1
Ep  200 | train_acc=0.2472, test_acc=0.0151 | ΔW_norm=1.623e-01 | avgΔW=1.570e-01 | grad_cos=-0.020 | avg_grad_cos=-0.006 | feat_div=3.218 | rem_dirs=31 | node_sim=0.014 | stage=1
Ep  300 | train_acc=0.5438, test_acc=0.0827 | ΔW_norm=1.313e-01 | avgΔW=1.314e-01 | grad_cos=0.014 | avg_grad_cos=-0.001 | feat_div=2.890 | rem_dirs=32 | node_sim=0.001 | stage=1
Ep  400 | train_acc=0.7024, test_acc=0.1309 | ΔW_norm=1.136e-01 | avgΔW=1.152e-01 | grad_cos=0.027 | avg_grad_cos=0.013 | feat_div=2.759 | rem_dirs=32 | node_sim=-0.001 | stage=1
Ep  500 | train_acc=0.8291, test_acc=0.1951 | ΔW_norm=1.105e-01 | avgΔW=1.110e-01 | grad_cos=0.024 | avg_grad_cos=-0.002 | feat_div=2.708 | rem_dirs=32 | node_sim=-0.003 | stage=1
Ep  600 | train_acc=0.9847, test_acc=0.4081 | ΔW_norm=9.460e-02 | avgΔW=1.009e-01 | grad_cos=0.005 | avg_grad_cos=0.007 | feat_div=2.776 | rem_dirs=32 | node_sim=-0.009 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.6300 | ΔW_norm=8.839e-02 | avgΔW=8.616e-02 | grad_cos=0.029 | avg_grad_cos=0.015 | feat_div=2.836 | rem_dirs=32 | node_sim=-0.013 | stage=1
*** Enter Stage II at epoch 778
Ep  800 | train_acc=1.0000, test_acc=0.8130 | ΔW_norm=1.131e-01 | avgΔW=1.107e-01 | grad_cos=0.005 | avg_grad_cos=-0.005 | feat_div=2.978 | rem_dirs=32 | node_sim=-0.016 | stage=2
*** Enter Stage III at epoch 895
Ep  900 | train_acc=1.0000, test_acc=0.9624 | ΔW_norm=1.245e-01 | avgΔW=1.229e-01 | grad_cos=0.006 | avg_grad_cos=0.012 | feat_div=3.034 | rem_dirs=32 | node_sim=-0.020 | stage=3
Ep 1000 | train_acc=1.0000, test_acc=0.9983 | ΔW_norm=1.302e-01 | avgΔW=1.304e-01 | grad_cos=0.033 | avg_grad_cos=0.049 | feat_div=3.125 | rem_dirs=32 | node_sim=-0.023 | stage=3
Total elapsed: 230.9483551979065
Stage start epochs: {1: 1, 2: 778, 3: 895}
Grokking point: 890
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.001_wd0.0001_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.001_wd0.0001_fig.png
=== Running hd = 32 lr = 0.0005 wd = 0.0
Ep    1 | train_acc=0.0106, test_acc=0.0115 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.287 | rem_dirs=32 | node_sim=0.004 | stage=1
Ep  100 | train_acc=0.0604, test_acc=0.0026 | ΔW_norm=6.827e-02 | avgΔW=6.965e-02 | grad_cos=0.002 | avg_grad_cos=-0.004 | feat_div=3.305 | rem_dirs=32 | node_sim=0.002 | stage=1
Ep  200 | train_acc=0.1010, test_acc=0.0034 | ΔW_norm=5.919e-02 | avgΔW=5.865e-02 | grad_cos=-0.019 | avg_grad_cos=-0.003 | feat_div=3.297 | rem_dirs=32 | node_sim=0.010 | stage=1
Ep  300 | train_acc=0.1361, test_acc=0.0049 | ΔW_norm=5.881e-02 | avgΔW=5.742e-02 | grad_cos=0.001 | avg_grad_cos=0.006 | feat_div=3.303 | rem_dirs=31 | node_sim=0.017 | stage=1
Ep  400 | train_acc=0.1920, test_acc=0.0077 | ΔW_norm=6.402e-02 | avgΔW=6.307e-02 | grad_cos=0.018 | avg_grad_cos=0.004 | feat_div=3.276 | rem_dirs=31 | node_sim=0.021 | stage=1
Ep  500 | train_acc=0.3078, test_acc=0.0242 | ΔW_norm=7.100e-02 | avgΔW=7.042e-02 | grad_cos=0.007 | avg_grad_cos=-0.005 | feat_div=3.208 | rem_dirs=31 | node_sim=0.016 | stage=1
Ep  600 | train_acc=0.4611, test_acc=0.0540 | ΔW_norm=6.872e-02 | avgΔW=6.858e-02 | grad_cos=0.012 | avg_grad_cos=-0.001 | feat_div=3.086 | rem_dirs=32 | node_sim=0.009 | stage=1
Ep  700 | train_acc=0.5599, test_acc=0.0818 | ΔW_norm=6.155e-02 | avgΔW=6.182e-02 | grad_cos=0.014 | avg_grad_cos=0.007 | feat_div=2.928 | rem_dirs=32 | node_sim=0.005 | stage=1
Ep  800 | train_acc=0.6484, test_acc=0.1044 | ΔW_norm=6.105e-02 | avgΔW=5.934e-02 | grad_cos=0.006 | avg_grad_cos=-0.004 | feat_div=2.901 | rem_dirs=32 | node_sim=0.004 | stage=1
Ep  900 | train_acc=0.7111, test_acc=0.1250 | ΔW_norm=5.695e-02 | avgΔW=5.752e-02 | grad_cos=0.009 | avg_grad_cos=-0.005 | feat_div=2.768 | rem_dirs=32 | node_sim=0.003 | stage=1
Ep 1000 | train_acc=0.7747, test_acc=0.1496 | ΔW_norm=5.457e-02 | avgΔW=5.692e-02 | grad_cos=0.008 | avg_grad_cos=0.008 | feat_div=2.740 | rem_dirs=32 | node_sim=0.004 | stage=1
Total elapsed: 232.1332049369812
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.0005_wd0.0_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.0005_wd0.0_fig.png
=== Running hd = 32 lr = 0.0005 wd = 0.0001
Ep    1 | train_acc=0.0108, test_acc=0.0113 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.287 | rem_dirs=32 | node_sim=0.005 | stage=1
Ep  100 | train_acc=0.0591, test_acc=0.0021 | ΔW_norm=7.433e-02 | avgΔW=7.440e-02 | grad_cos=0.003 | avg_grad_cos=-0.002 | feat_div=3.302 | rem_dirs=32 | node_sim=-0.001 | stage=1
Ep  200 | train_acc=0.0938, test_acc=0.0030 | ΔW_norm=6.199e-02 | avgΔW=6.153e-02 | grad_cos=-0.017 | avg_grad_cos=-0.005 | feat_div=3.298 | rem_dirs=32 | node_sim=0.005 | stage=1
Ep  300 | train_acc=0.1358, test_acc=0.0047 | ΔW_norm=6.454e-02 | avgΔW=6.286e-02 | grad_cos=-0.003 | avg_grad_cos=0.005 | feat_div=3.300 | rem_dirs=31 | node_sim=0.010 | stage=1
Ep  400 | train_acc=0.2037, test_acc=0.0098 | ΔW_norm=7.027e-02 | avgΔW=6.873e-02 | grad_cos=0.015 | avg_grad_cos=0.002 | feat_div=3.261 | rem_dirs=31 | node_sim=0.012 | stage=1
Ep  500 | train_acc=0.3427, test_acc=0.0308 | ΔW_norm=7.929e-02 | avgΔW=7.990e-02 | grad_cos=0.006 | avg_grad_cos=-0.002 | feat_div=3.148 | rem_dirs=31 | node_sim=0.006 | stage=1
Ep  600 | train_acc=0.4860, test_acc=0.0640 | ΔW_norm=7.009e-02 | avgΔW=7.077e-02 | grad_cos=-0.005 | avg_grad_cos=0.000 | feat_div=2.994 | rem_dirs=31 | node_sim=-0.000 | stage=1
Ep  700 | train_acc=0.5897, test_acc=0.0861 | ΔW_norm=6.503e-02 | avgΔW=6.393e-02 | grad_cos=0.000 | avg_grad_cos=0.006 | feat_div=2.856 | rem_dirs=31 | node_sim=-0.002 | stage=1
Ep  800 | train_acc=0.6654, test_acc=0.1046 | ΔW_norm=5.778e-02 | avgΔW=5.876e-02 | grad_cos=-0.002 | avg_grad_cos=-0.003 | feat_div=2.826 | rem_dirs=31 | node_sim=-0.003 | stage=1
Ep  900 | train_acc=0.7321, test_acc=0.1250 | ΔW_norm=5.664e-02 | avgΔW=5.690e-02 | grad_cos=0.022 | avg_grad_cos=0.003 | feat_div=2.702 | rem_dirs=31 | node_sim=-0.003 | stage=1
Ep 1000 | train_acc=0.7991, test_acc=0.1469 | ΔW_norm=5.245e-02 | avgΔW=5.488e-02 | grad_cos=0.003 | avg_grad_cos=-0.007 | feat_div=2.704 | rem_dirs=31 | node_sim=-0.003 | stage=1
Total elapsed: 237.94261264801025
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.0005_wd0.0001_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd32_lr0.0005_wd0.0001_fig.png
=== Running hd = 64 lr = 0.001 wd = 0.0
Ep    1 | train_acc=0.0102, test_acc=0.0087 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.936 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  100 | train_acc=0.4177, test_acc=0.0026 | ΔW_norm=2.558e-01 | avgΔW=2.559e-01 | grad_cos=-0.012 | avg_grad_cos=-0.002 | feat_div=3.935 | rem_dirs=64 | node_sim=0.003 | stage=1
Ep  200 | train_acc=0.9358, test_acc=0.0283 | ΔW_norm=1.918e-01 | avgΔW=1.986e-01 | grad_cos=0.006 | avg_grad_cos=-0.004 | feat_div=3.841 | rem_dirs=64 | node_sim=0.004 | stage=1
Ep  300 | train_acc=1.0000, test_acc=0.0642 | ΔW_norm=1.053e-01 | avgΔW=1.084e-01 | grad_cos=0.002 | avg_grad_cos=-0.006 | feat_div=3.776 | rem_dirs=64 | node_sim=0.003 | stage=1
Ep  400 | train_acc=1.0000, test_acc=0.0755 | ΔW_norm=7.324e-02 | avgΔW=7.466e-02 | grad_cos=-0.003 | avg_grad_cos=0.003 | feat_div=3.745 | rem_dirs=64 | node_sim=0.002 | stage=1
Ep  500 | train_acc=1.0000, test_acc=0.0818 | ΔW_norm=6.032e-02 | avgΔW=6.003e-02 | grad_cos=0.016 | avg_grad_cos=-0.001 | feat_div=3.737 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.0861 | ΔW_norm=5.200e-02 | avgΔW=5.194e-02 | grad_cos=-0.005 | avg_grad_cos=-0.002 | feat_div=3.750 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.0922 | ΔW_norm=4.491e-02 | avgΔW=4.539e-02 | grad_cos=-0.003 | avg_grad_cos=-0.006 | feat_div=3.728 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  800 | train_acc=1.0000, test_acc=0.0916 | ΔW_norm=4.089e-02 | avgΔW=4.080e-02 | grad_cos=-0.010 | avg_grad_cos=-0.003 | feat_div=3.701 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.0922 | ΔW_norm=3.700e-02 | avgΔW=3.692e-02 | grad_cos=-0.012 | avg_grad_cos=-0.004 | feat_div=3.708 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep 1000 | train_acc=1.0000, test_acc=0.0931 | ΔW_norm=7.419e-02 | avgΔW=7.085e-02 | grad_cos=0.004 | avg_grad_cos=-0.003 | feat_div=3.737 | rem_dirs=64 | node_sim=0.001 | stage=1
Total elapsed: 231.07290267944336
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.001_wd0.0_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.001_wd0.0_fig.png
=== Running hd = 64 lr = 0.001 wd = 0.0001
Ep    1 | train_acc=0.0102, test_acc=0.0087 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.935 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  100 | train_acc=0.3912, test_acc=0.0026 | ΔW_norm=2.703e-01 | avgΔW=2.685e-01 | grad_cos=-0.012 | avg_grad_cos=-0.001 | feat_div=3.937 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  200 | train_acc=0.9496, test_acc=0.0410 | ΔW_norm=1.998e-01 | avgΔW=2.036e-01 | grad_cos=0.003 | avg_grad_cos=-0.004 | feat_div=3.815 | rem_dirs=64 | node_sim=0.002 | stage=1
Ep  300 | train_acc=1.0000, test_acc=0.0850 | ΔW_norm=1.321e-01 | avgΔW=1.307e-01 | grad_cos=0.008 | avg_grad_cos=-0.004 | feat_div=3.716 | rem_dirs=64 | node_sim=-0.000 | stage=1
Ep  400 | train_acc=1.0000, test_acc=0.1256 | ΔW_norm=1.697e-01 | avgΔW=1.683e-01 | grad_cos=0.004 | avg_grad_cos=0.005 | feat_div=3.660 | rem_dirs=64 | node_sim=-0.002 | stage=1
Ep  500 | train_acc=1.0000, test_acc=0.2064 | ΔW_norm=1.862e-01 | avgΔW=1.851e-01 | grad_cos=-0.003 | avg_grad_cos=-0.004 | feat_div=3.647 | rem_dirs=64 | node_sim=-0.003 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.4657 | ΔW_norm=2.062e-01 | avgΔW=2.044e-01 | grad_cos=-0.001 | avg_grad_cos=-0.002 | feat_div=3.677 | rem_dirs=64 | node_sim=-0.006 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.9798 | ΔW_norm=2.318e-01 | avgΔW=2.291e-01 | grad_cos=0.048 | avg_grad_cos=0.022 | feat_div=3.640 | rem_dirs=64 | node_sim=-0.010 | stage=1
*** Enter Stage II at epoch 708
*** Enter Stage III at epoch 709
Ep  800 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=1.996e-01 | avgΔW=1.938e-01 | grad_cos=0.062 | avg_grad_cos=0.081 | feat_div=3.580 | rem_dirs=64 | node_sim=-0.008 | stage=3
Ep  900 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=1.939e-01 | avgΔW=1.993e-01 | grad_cos=0.122 | avg_grad_cos=0.121 | feat_div=3.689 | rem_dirs=64 | node_sim=-0.012 | stage=3
Ep 1000 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=1.838e-01 | avgΔW=1.847e-01 | grad_cos=0.158 | avg_grad_cos=0.158 | feat_div=3.726 | rem_dirs=64 | node_sim=-0.011 | stage=3
Total elapsed: 220.67678260803223
Stage start epochs: {1: 1, 2: 708, 3: 709}
Grokking point: 682
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.001_wd0.0001_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.001_wd0.0001_fig.png
=== Running hd = 64 lr = 0.0005 wd = 0.0
Ep    1 | train_acc=0.0106, test_acc=0.0104 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.934 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  100 | train_acc=0.2094, test_acc=0.0006 | ΔW_norm=1.380e-01 | avgΔW=1.396e-01 | grad_cos=-0.016 | avg_grad_cos=-0.002 | feat_div=3.941 | rem_dirs=64 | node_sim=-0.003 | stage=1
Ep  200 | train_acc=0.3946, test_acc=0.0030 | ΔW_norm=1.226e-01 | avgΔW=1.225e-01 | grad_cos=-0.001 | avg_grad_cos=-0.007 | feat_div=3.932 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  300 | train_acc=0.6599, test_acc=0.0087 | ΔW_norm=1.179e-01 | avgΔW=1.180e-01 | grad_cos=0.009 | avg_grad_cos=0.001 | feat_div=3.899 | rem_dirs=64 | node_sim=0.003 | stage=1
Ep  400 | train_acc=0.9264, test_acc=0.0304 | ΔW_norm=1.074e-01 | avgΔW=1.088e-01 | grad_cos=-0.008 | avg_grad_cos=-0.002 | feat_div=3.851 | rem_dirs=64 | node_sim=0.003 | stage=1
Ep  500 | train_acc=1.0000, test_acc=0.0589 | ΔW_norm=8.416e-02 | avgΔW=8.471e-02 | grad_cos=0.012 | avg_grad_cos=0.005 | feat_div=3.814 | rem_dirs=64 | node_sim=0.002 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.0816 | ΔW_norm=6.604e-02 | avgΔW=6.665e-02 | grad_cos=-0.004 | avg_grad_cos=-0.002 | feat_div=3.814 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.1007 | ΔW_norm=5.660e-02 | avgΔW=5.650e-02 | grad_cos=0.012 | avg_grad_cos=-0.007 | feat_div=3.782 | rem_dirs=64 | node_sim=0.000 | stage=1
Ep  800 | train_acc=1.0000, test_acc=0.1103 | ΔW_norm=4.867e-02 | avgΔW=4.911e-02 | grad_cos=-0.014 | avg_grad_cos=-0.004 | feat_div=3.753 | rem_dirs=64 | node_sim=-0.000 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.1199 | ΔW_norm=4.439e-02 | avgΔW=4.403e-02 | grad_cos=-0.004 | avg_grad_cos=0.004 | feat_div=3.764 | rem_dirs=64 | node_sim=-0.001 | stage=1
Ep 1000 | train_acc=1.0000, test_acc=0.1241 | ΔW_norm=3.891e-02 | avgΔW=3.917e-02 | grad_cos=-0.008 | avg_grad_cos=0.005 | feat_div=3.776 | rem_dirs=64 | node_sim=-0.001 | stage=1
Total elapsed: 228.48026275634766
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.0005_wd0.0_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.0005_wd0.0_fig.png
=== Running hd = 64 lr = 0.0005 wd = 0.0001
Ep    1 | train_acc=0.0104, test_acc=0.0102 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=3.934 | rem_dirs=64 | node_sim=0.001 | stage=1
Ep  100 | train_acc=0.1941, test_acc=0.0009 | ΔW_norm=1.436e-01 | avgΔW=1.447e-01 | grad_cos=-0.015 | avg_grad_cos=-0.001 | feat_div=3.942 | rem_dirs=64 | node_sim=-0.003 | stage=1
Ep  200 | train_acc=0.3741, test_acc=0.0034 | ΔW_norm=1.287e-01 | avgΔW=1.280e-01 | grad_cos=0.002 | avg_grad_cos=-0.007 | feat_div=3.933 | rem_dirs=64 | node_sim=-0.000 | stage=1
Ep  300 | train_acc=0.6669, test_acc=0.0113 | ΔW_norm=1.234e-01 | avgΔW=1.241e-01 | grad_cos=0.009 | avg_grad_cos=-0.000 | feat_div=3.894 | rem_dirs=64 | node_sim=0.002 | stage=1
Ep  400 | train_acc=0.9358, test_acc=0.0442 | ΔW_norm=1.121e-01 | avgΔW=1.129e-01 | grad_cos=-0.006 | avg_grad_cos=-0.001 | feat_div=3.841 | rem_dirs=64 | node_sim=-0.000 | stage=1
Ep  500 | train_acc=1.0000, test_acc=0.0840 | ΔW_norm=8.698e-02 | avgΔW=8.764e-02 | grad_cos=0.005 | avg_grad_cos=0.003 | feat_div=3.798 | rem_dirs=64 | node_sim=-0.003 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.1139 | ΔW_norm=8.603e-02 | avgΔW=8.484e-02 | grad_cos=-0.005 | avg_grad_cos=-0.003 | feat_div=3.787 | rem_dirs=64 | node_sim=-0.004 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.1537 | ΔW_norm=9.871e-02 | avgΔW=9.598e-02 | grad_cos=0.020 | avg_grad_cos=-0.001 | feat_div=3.751 | rem_dirs=64 | node_sim=-0.005 | stage=1
Ep  800 | train_acc=1.0000, test_acc=0.2249 | ΔW_norm=1.022e-01 | avgΔW=1.008e-01 | grad_cos=-0.026 | avg_grad_cos=-0.005 | feat_div=3.718 | rem_dirs=64 | node_sim=-0.006 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.3392 | ΔW_norm=1.051e-01 | avgΔW=1.043e-01 | grad_cos=-0.002 | avg_grad_cos=0.003 | feat_div=3.716 | rem_dirs=64 | node_sim=-0.007 | stage=1
Ep 1000 | train_acc=1.0000, test_acc=0.5090 | ΔW_norm=1.081e-01 | avgΔW=1.064e-01 | grad_cos=0.009 | avg_grad_cos=0.007 | feat_div=3.694 | rem_dirs=64 | node_sim=-0.008 | stage=1
Total elapsed: 228.0756013393402
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.0005_wd0.0001_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd64_lr0.0005_wd0.0001_fig.png
=== Running hd = 128 lr = 0.001 wd = 0.0
Ep    1 | train_acc=0.0064, test_acc=0.0045 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=4.467 | rem_dirs=128 | node_sim=0.001 | stage=1
Ep  100 | train_acc=1.0000, test_acc=0.0021 | ΔW_norm=1.478e-01 | avgΔW=1.579e-01 | grad_cos=-0.004 | avg_grad_cos=-0.000 | feat_div=4.477 | rem_dirs=128 | node_sim=-0.003 | stage=1
Ep  200 | train_acc=1.0000, test_acc=0.0038 | ΔW_norm=6.558e-02 | avgΔW=6.699e-02 | grad_cos=0.004 | avg_grad_cos=0.004 | feat_div=4.475 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  300 | train_acc=1.0000, test_acc=0.0043 | ΔW_norm=5.044e-02 | avgΔW=5.151e-02 | grad_cos=0.001 | avg_grad_cos=0.000 | feat_div=4.466 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  400 | train_acc=1.0000, test_acc=0.0060 | ΔW_norm=4.355e-02 | avgΔW=4.344e-02 | grad_cos=-0.000 | avg_grad_cos=0.001 | feat_div=4.463 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  500 | train_acc=1.0000, test_acc=0.0070 | ΔW_norm=3.796e-02 | avgΔW=3.790e-02 | grad_cos=-0.010 | avg_grad_cos=-0.004 | feat_div=4.464 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.0077 | ΔW_norm=3.410e-02 | avgΔW=3.431e-02 | grad_cos=-0.018 | avg_grad_cos=-0.003 | feat_div=4.464 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.0085 | ΔW_norm=3.521e-02 | avgΔW=3.439e-02 | grad_cos=0.005 | avg_grad_cos=0.009 | feat_div=4.459 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  800 | train_acc=1.0000, test_acc=0.0083 | ΔW_norm=2.048e-01 | avgΔW=1.886e-01 | grad_cos=0.007 | avg_grad_cos=0.009 | feat_div=4.438 | rem_dirs=128 | node_sim=0.007 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.0089 | ΔW_norm=2.650e-03 | avgΔW=2.645e-03 | grad_cos=0.028 | avg_grad_cos=0.022 | feat_div=4.418 | rem_dirs=128 | node_sim=0.011 | stage=1
Ep 1000 | train_acc=1.0000, test_acc=0.0085 | ΔW_norm=3.110e-03 | avgΔW=3.056e-03 | grad_cos=0.011 | avg_grad_cos=0.011 | feat_div=4.413 | rem_dirs=128 | node_sim=0.011 | stage=1
Total elapsed: 236.23830032348633
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0_fig.png
=== Running hd = 128 lr = 0.001 wd = 0.0001
Ep    1 | train_acc=0.0064, test_acc=0.0045 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=4.467 | rem_dirs=128 | node_sim=0.001 | stage=1
Ep  100 | train_acc=1.0000, test_acc=0.0011 | ΔW_norm=2.051e-01 | avgΔW=2.171e-01 | grad_cos=-0.006 | avg_grad_cos=0.001 | feat_div=4.474 | rem_dirs=128 | node_sim=-0.003 | stage=1
Ep  200 | train_acc=1.0000, test_acc=0.0125 | ΔW_norm=2.380e-01 | avgΔW=2.321e-01 | grad_cos=-0.005 | avg_grad_cos=0.002 | feat_div=4.468 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  300 | train_acc=1.0000, test_acc=0.1841 | ΔW_norm=3.392e-01 | avgΔW=3.393e-01 | grad_cos=0.013 | avg_grad_cos=0.005 | feat_div=4.402 | rem_dirs=128 | node_sim=-0.005 | stage=1
Ep  400 | train_acc=1.0000, test_acc=0.9813 | ΔW_norm=3.982e-01 | avgΔW=3.995e-01 | grad_cos=0.024 | avg_grad_cos=0.024 | feat_div=4.212 | rem_dirs=128 | node_sim=-0.004 | stage=1
*** Enter Stage II at epoch 404
*** Enter Stage III at epoch 405
Ep  500 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=3.251e-01 | avgΔW=3.274e-01 | grad_cos=0.092 | avg_grad_cos=0.086 | feat_div=4.048 | rem_dirs=128 | node_sim=-0.002 | stage=3
Ep  600 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=3.415e-01 | avgΔW=3.402e-01 | grad_cos=0.137 | avg_grad_cos=0.143 | feat_div=3.964 | rem_dirs=128 | node_sim=-0.005 | stage=3
Ep  700 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=3.523e-01 | avgΔW=3.618e-01 | grad_cos=0.180 | avg_grad_cos=0.184 | feat_div=3.932 | rem_dirs=128 | node_sim=-0.005 | stage=3
Ep  800 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=3.258e-01 | avgΔW=3.298e-01 | grad_cos=0.195 | avg_grad_cos=0.198 | feat_div=3.972 | rem_dirs=128 | node_sim=-0.005 | stage=3
Ep  900 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=3.142e-01 | avgΔW=3.308e-01 | grad_cos=0.201 | avg_grad_cos=0.192 | feat_div=3.990 | rem_dirs=128 | node_sim=-0.005 | stage=3
Ep 1000 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=3.300e-01 | avgΔW=3.315e-01 | grad_cos=0.205 | avg_grad_cos=0.197 | feat_div=4.002 | rem_dirs=128 | node_sim=-0.001 | stage=3
Total elapsed: 236.88084292411804
Stage start epochs: {1: 1, 2: 404, 3: 405}
Grokking point: 386
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0001_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0001_fig.png
Grokking point: 386
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0001_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0001_fig.png
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0001_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0001_fig.png
=== Running hd = 128 lr = 0.0005 wd = 0.0
Ep    1 | train_acc=0.0077, test_acc=0.0079 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=4.462 | rem_dirs=128 | node_sim=0.000 | stage=1
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.001_wd0.0001_fig.png
=== Running hd = 128 lr = 0.0005 wd = 0.0
Ep    1 | train_acc=0.0077, test_acc=0.0079 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=4.462 | rem_dirs=128 | node_sim=0.000 | stage=1
=== Running hd = 128 lr = 0.0005 wd = 0.0
Ep    1 | train_acc=0.0077, test_acc=0.0079 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=4.462 | rem_dirs=128 | node_sim=0.000 | stage=1
Ep  100 | train_acc=0.8994, test_acc=0.0000 | ΔW_norm=2.452e-01 | avgΔW=2.498e-01 | grad_cos=-0.005 | avg_grad_cos=0.006 | feat_div=4.464 | rem_dirs=128 | node_sim=-0.003 | stage=1
Ep  100 | train_acc=0.8994, test_acc=0.0000 | ΔW_norm=2.452e-01 | avgΔW=2.498e-01 | grad_cos=-0.005 | avg_grad_cos=0.006 | feat_div=4.464 | rem_dirs=128 | node_sim=-0.003 | stage=1
Ep  200 | train_acc=1.0000, test_acc=0.0011 | ΔW_norm=1.013e-01 | avgΔW=1.048e-01 | grad_cos=0.010 | avg_grad_cos=0.007 | feat_div=4.467 | rem_dirs=128 | node_sim=-0.003 | stage=1
Ep  300 | train_acc=1.0000, test_acc=0.0013 | ΔW_norm=6.781e-02 | avgΔW=6.950e-02 | grad_cos=0.002 | avg_grad_cos=0.001 | feat_div=4.462 | rem_dirs=128 | node_sim=-0.003 | stage=1
Ep  400 | train_acc=1.0000, test_acc=0.0019 | ΔW_norm=5.567e-02 | avgΔW=5.576e-02 | grad_cos=-0.002 | avg_grad_cos=0.001 | feat_div=4.456 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  500 | train_acc=1.0000, test_acc=0.0030 | ΔW_norm=4.698e-02 | avgΔW=4.746e-02 | grad_cos=-0.006 | avg_grad_cos=-0.002 | feat_div=4.462 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.0032 | ΔW_norm=4.140e-02 | avgΔW=4.187e-02 | grad_cos=-0.016 | avg_grad_cos=-0.002 | feat_div=4.457 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.0032 | ΔW_norm=4.140e-02 | avgΔW=4.187e-02 | grad_cos=-0.016 | avg_grad_cos=-0.002 | feat_div=4.457 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.0036 | ΔW_norm=3.656e-02 | avgΔW=3.716e-02 | grad_cos=0.001 | avg_grad_cos=0.006 | feat_div=4.449 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  800 | train_acc=1.0000, test_acc=0.0038 | ΔW_norm=3.224e-02 | avgΔW=3.251e-02 | grad_cos=0.004 | avg_grad_cos=0.004 | feat_div=4.463 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.0047 | ΔW_norm=6.799e-02 | avgΔW=6.288e-02 | grad_cos=0.004 | avg_grad_cos=0.004 | feat_div=4.445 | rem_dirs=128 | node_sim=-0.002 | stage=1
Ep  800 | train_acc=1.0000, test_acc=0.0038 | ΔW_norm=3.224e-02 | avgΔW=3.251e-02 | grad_cos=0.004 | avg_grad_cos=0.004 | feat_div=4.463 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.0047 | ΔW_norm=6.799e-02 | avgΔW=6.288e-02 | grad_cos=0.004 | avg_grad_cos=0.004 | feat_div=4.445 | rem_dirs=128 | node_sim=-0.002 | stage=1
Ep  900 | train_acc=1.0000, test_acc=0.0047 | ΔW_norm=6.799e-02 | avgΔW=6.288e-02 | grad_cos=0.004 | avg_grad_cos=0.004 | feat_div=4.445 | rem_dirs=128 | node_sim=-0.002 | stage=1
Ep 1000 | train_acc=1.0000, test_acc=0.0049 | ΔW_norm=1.906e-01 | avgΔW=1.851e-01 | grad_cos=0.003 | avg_grad_cos=-0.001 | feat_div=4.398 | rem_dirs=128 | node_sim=0.024 | stage=1
Ep 1000 | train_acc=1.0000, test_acc=0.0049 | ΔW_norm=1.906e-01 | avgΔW=1.851e-01 | grad_cos=0.003 | avg_grad_cos=-0.001 | feat_div=4.398 | rem_dirs=128 | node_sim=0.024 | stage=1
Total elapsed: 230.95400428771973
Stage start epochs: {1: 1}
Stage start epochs: {1: 1}
Grokking point: None
Saved history to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.0005_wd0.0_hist.json
Saved figure to f:\LLM\Emergence_Generalization\modNet\grok_mod_full_m97_hd128_lr0.0005_wd0.0_fig.png

解读：
模型在训练集上迅速拟合（train_acc 100%）但验证几乎无提升 → 与阶段 I 的典型表现吻合：记忆但不泛化。
指标上：avg_grad_cos 非常低（≈0），说明梯度方向未稳定/结构化；rem_dirs 没下降（128→128），说明“特征方向覆盖”几乎无进展；feat_div 稳定、未见上升然后下降。
虽然 ΔW_norm 初期较大（如 ~0.15）但随着训练而下降，说明虽然权重变化有，但并未进入真正的特征学习轨迹。
模型未进入阶段 II 或 III，因此无 grokking点。
这与理论非常吻合：尤其 无正则化（wd=0） 的情况下，根据 Li₂ 框架，“weight decay” 是启动特征学习的关键因素之一。该论文指出：当没有正则化，隐藏层难以跳出记忆‐拟合状态。


=== Running hd = 128 lr = 0.0005 wd = 0.0001
Ep    1 | train_acc=0.0074, test_acc=0.0079 | ΔW_norm=0.000e+00 | avgΔW=0.000e+00 | grad_cos=0.000 | avg_grad_cos=0.000 | feat_div=4.462 | rem_dirs=128 | node_sim=0.000 | stage=1
Ep  100 | train_acc=0.8325, test_acc=0.0002 | ΔW_norm=2.614e-01 | avgΔW=2.666e-01 | grad_cos=-0.004 | avg_grad_cos=0.005 | feat_div=4.463 | rem_dirs=128 | node_sim=-0.003 | stage=1
Ep  200 | train_acc=1.0000, test_acc=0.0026 | ΔW_norm=1.319e-01 | avgΔW=1.344e-01 | grad_cos=0.006 | avg_grad_cos=0.005 | feat_div=4.465 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  300 | train_acc=1.0000, test_acc=0.0036 | ΔW_norm=1.469e-01 | avgΔW=1.462e-01 | grad_cos=0.004 | avg_grad_cos=0.002 | feat_div=4.457 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  400 | train_acc=1.0000, test_acc=0.0145 | ΔW_norm=1.872e-01 | avgΔW=1.844e-01 | grad_cos=-0.002 | avg_grad_cos=0.000 | feat_div=4.449 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  500 | train_acc=1.0000, test_acc=0.0657 | ΔW_norm=1.983e-01 | avgΔW=1.984e-01 | grad_cos=0.003 | avg_grad_cos=0.008 | feat_div=4.430 | rem_dirs=128 | node_sim=-0.004 | stage=1
Ep  600 | train_acc=1.0000, test_acc=0.2797 | ΔW_norm=2.134e-01 | avgΔW=2.133e-01 | grad_cos=-0.009 | avg_grad_cos=0.002 | feat_div=4.396 | rem_dirs=128 | node_sim=-0.005 | stage=1
Ep  700 | train_acc=1.0000, test_acc=0.8561 | ΔW_norm=2.362e-01 | avgΔW=2.371e-01 | grad_cos=0.022 | avg_grad_cos=0.021 | feat_div=4.302 | rem_dirs=128 | node_sim=-0.005 | stage=1
*** Enter Stage II at epoch 738
*** Enter Stage III at epoch 739
Ep  800 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=2.258e-01 | avgΔW=2.267e-01 | grad_cos=0.054 | avg_grad_cos=0.053 | feat_div=4.062 | rem_dirs=128 | node_sim=-0.003 | stage=3
Ep  900 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=1.994e-01 | avgΔW=2.050e-01 | grad_cos=0.129 | avg_grad_cos=0.135 | feat_div=3.896 | rem_dirs=128 | node_sim=-0.001 | stage=3
Ep 1000 | train_acc=1.0000, test_acc=1.0000 | ΔW_norm=1.744e-01 | avgΔW=1.740e-01 | grad_cos=0.191 | avg_grad_cos=0.184 | feat_div=3.888 | rem_dirs=128 | node_sim=-0.004 | stage=3
Total elapsed: 238.52488160133362
Stage start epochs: {1: 1, 2: 738, 3: 739}
Grokking point: 722

解读：
加入了微小的 weight_decay = 0.0001 后：训练集依然很快拟合，但验证开始慢慢提升，然后在 ~ep 400 处出现急跃（≈0.98 → 1.0） → 典型 grokking行为。
阶段切换被触发（stage II 在 ep404，stage III 在 ep405）说明你的判定逻辑捕捉到了该点。
指标变化支持：avg_grad_cos 在 ep300→400 从 ~0.005→0.024 上升；avgΔW 持续增加至 ~0.34；同时 feat_div 从 ~4.468下降至 ~4.212，说明隐藏表示结构化/聚焦；虽然 rem_dirs 仍未下降（可能因为候选方向设定的问题），但模型已进入泛化。
这与理论吻合：weight decay 使隐藏层渐渐开始学习可泛化特征（进入阶段 II），随后节点间协作/交互（阶段 III）并快速泛化。


--------------------------------------------------------------------------------------------------------------------------------------------------------
## 指标计算方式

1. **ΔW_norm**

   * 计算方式：每个 epoch 计算隐藏层 `fc1.weight` 的权重矩阵 (W)（形如 hidden_dim × (hidden_dim×2)）的当前值与上一个 epoch 值的差矩阵 (\Delta W = W_{\text{current}} - W_{\text{prev}})。然后取该差矩阵的范数（欧几里得范数／L2 范数） (|\Delta W|)。
   * 在脚本里：`delta_norm = np.linalg.norm(w_fc1 - prev_w_fc1)`。
   * 意义：权重在隐藏层第一线性层的变化量。权重大幅变化意味着隐藏层正在较积极地更新其表征／特征方向。变化非常微小或下降意味着隐藏层几乎停滞或收敛。

2. **avgΔW**

   * 计算方式：在脚本中用滑动平均（window = 10 等）计算最近若干 epoch（例如最后 10 条）ΔW_norm 的平均值。
   * 意义：比单一 epoch 的 ΔW_norm 更稳定，减弱噪声／突变。反映 “最近隐藏层权重更新速率” 的趋势。

3. **grad_cos**

   * 计算方式：每 epoch 获取当前 `fc1.weight.grad` 梯度矩阵 (G)，将其 flatten 成向量，保存在一个缓冲区（例如最近 5 个 epoch 的梯度向量）。然后计算这些向量之间余弦相似度矩阵，并取上三角的平均值。
   * 在脚本：

     ```python
     grads_mat = np.stack(grad_buffer)
     norms = np.linalg.norm(grads_mat, axis=1, keepdims=True) + 1e-12
     cos_matrix = (grads_mat @ grads_mat.T) / (norms @ norms.T)
     grad_cos_sim = float(cos_matrix[triu_mask].mean())
     ```
   * 意义：衡量隐藏层权重梯度在 “方向” 上的一致性。较高的余弦相似度表示最近几个 epoch 梯度方向较为一致／结构化；较低表示梯度方向在大范围内震荡、无组织。

4. **avg_grad_cos**

   * 计算方式：类似 avgΔW，用滑动平均对 grad_cos 取平均。
   * 意义：反映“最近隐藏层梯度方向稳定性”的趋势。

5. **feat_div**（Feature Diversity）

   * 计算方式：在每个 epoch 取一个 batch 的隐藏层输出 (h_2)（隐藏层激活，形如 batch_size × hidden_dim），做 SVD：(h_2 = U,S,V^T)。取奇异值向量 (S = [s_1, s_2, …])，归一化 (S_{\text{norm}} = S / \sum S)。然后计算熵：(-\sum_i S_{\text{norm},i}\log S_{\text{norm},i})。
   * 在脚本：

     ```python
     U, S, Vt = np.linalg.svd(h2_np, full_matrices=False)
     S_norm = S / (S.sum() + 1e-12)
     entropy = -np.sum(S_norm * np.log(S_norm + 1e-12))
     feature_div = float(entropy)
     ```
   * 意义：衡量隐藏层激活在不同方向／特征子空间上的“分散度”或“多样性”。高熵表示激活分布较为均匀（即很多隐藏单元在发挥作用、表征丰富）；低熵可能表示表示集中在少数方向或者隐藏单元协同导致冗余。

6. **rem_dirs**（Remaining Candidate Feature Directions）

   * 计算方式：在脚本中预构造了一个候选特征方向集合 (U_{np})（例如 K 个方向，每个是一个长度 D 向量，D = hidden_dim × 2）。然后把当前隐藏层权重矩阵 flatten 转为 w_flat (hidden_dim × D)，计算 w_flat 与 U_np 的余弦相似度矩阵：形状 hidden_dim × K。然后对每个候选方向 k 取最大相似度：(\max_j \cos(w_j, u_k))。若该最大相似度 ≥ 阈值 tau_cov，则认为 “方向 k 已被覆盖”。于是 `num_covered = sum(covered)`；`num_remaining = K - num_covered`。
   * 意义：尝试量化隐藏层“已学”多少候选特征方向、“还剩多少特征方向未被覆盖”。是用来监控“特征覆盖”进度的指标。

7. **node_sim**（Hidden Nodes Similarity Mean）

   * 计算方式：计算当前 w_flat (hidden_dim × D)，然后计算两两余弦相似度矩阵 (hidden_dim × hidden_dim)。取上三角部分平均值（即只算不同节点间的余弦相似度）。
   * 意义：衡量隐藏层各隐藏单元权重向量之间的“平均相似度”。如果节点权重高度相似（node_sim 高），说明隐藏单元尚未分化、重复性强；如果 node_sim 下降，则表示隐藏单元开始“分工”或“专化”，各自学到不同方向。

---

## ✏️ 指标反映的训练／隐藏层动态

结合监控的 “阶段 I → II → III”框架，这些指标可以这样 interpret：

* 阶段 I（懒惰学习／记忆阶段）：

  * ΔW_norm 较大但可能逐渐下降（训练集拟合迅速）；
  * grad_cos 低且波动（梯度方向无结构）；
  * feat_div 可能偏低或无明显提升（隐藏表示尚无多个“特征子空间”被激活）；
  * rem_dirs 高（几乎所有候选方向未覆盖）；
  * node_sim 高（隐藏单元还没分化或专化）。

* 阶段 II（独立特征学习）：

  * ΔW_norm 上升／维持较高（隐藏层权重活跃更新）；
  * grad_cos 开始上升（梯度方向稳定化，隐藏层朝特征方向学习）；
  * feat_div 上升（激活分散在更多特征方向）；
  * rem_dirs 开始下降（隐藏层节点覆盖更多候选特征方向）；
  * node_sim 开始下降（隐藏单元分化）。

* 阶段 III（交互特征学习／泛化跃迁）：

  * ΔW_norm 可能下降或稳定（权重更新放缓但结构化）；
  * grad_cos 高或稳定；
  * feat_div 可能略下降或趋于稳定（表示表征已被整理）；
  * rem_dirs 接近 0 或很低（几乎所有候选特征方向已被覆盖）；
  * node_sim 较低（节点高度分化）。
  * 验证精度（test_acc）大幅跃升 (“grok” 点) 出现。




```
ΔW_norm=2.362e-01 | avgΔW=2.371e-01 | grad_cos=0.022 | avg_grad_cos=0.021 | feat_div=4.302 | rem_dirs=128 | node_sim=-0.005
```

逐项看：

* ΔW_norm ≈ 0.236、avgΔW ≈ 0.237：隐藏层权重在更新，并且更新量较大（相比早期 ΔW_norm ~0.04 的情况）。说明隐藏层已比之前“更活跃”在改变。
* grad_cos ≈ 0.022、avg_grad_cos ≈ 0.021：梯度方向余弦相似度 ≈0.02，很低，但比早期更高（比如之前 ~0.005）。说明梯度方向可能刚开始有一些稳定趋势，但还是非常小。
* feat_div ≈ 4.302：特征多样性熵数值。具体数值难以直接比较（取决 batch size, hidden_dim 等），但如果相比早期更高或略变化，则说明隐藏层激活有变。
* rem_dirs = 128：表示设定 K = hidden_dim = 128 候选方向数，目前覆盖数为 0（或覆盖不足至达成阈值），仍未下降。说明按照设定的候选方向集合，隐藏层尚未对这些方向产生强对齐。
* node_sim ≈ −0.005：节点平均余弦相似度为负值（可能因为权重向量有不同方向、可能正负向量平均余弦接近0或略负）。总体说明隐藏单元间并未高度聚类或同向，可能已有一定分化。

综上，这条日志表明：隐藏层权重变化（ΔW_norm）显示活跃，说明训练不再纯拟合；梯度方向稳定性 (avg_grad_cos) 虽略有提升，但仍低；候选方向覆盖数 (rem_dirs) 仍高未下降；节点相似度 (node_sim) 很低或略负，说明隐藏单元可能已经分化或至少彼此并不高度相似。

**根据阶段判定逻辑**：

* 可能正处于阶段 II 的早期（隐藏层开始活跃）或仍在阶段 I 末期。
* 但因为 rem_dirs 未下降、grad_cos 很低，因此还未明确进入阶段 III。
* 如果接下来 avg_grad_cos 进一步上升（例如 >0.05 或 >0.1），而 rem_dirs 开始下降、test_acc 突跃，则即将或已进入阶段 III。
